<?xml version="1.0" encoding="UTF-8"?>
<package>
  <!-- header contient les infos sur le patch / module. Pas la peine de s'y attarder -->
  <header>
    <name>Lien PackageMgr</name>
    <author>Bontiv</author>
    <link>http://remi.bonnetchangai.free.fr</link>
  </header>

  <!-- body contient les modifications. Tous ses sous-noeud sont facultatifs -->
  <body>

    <!-- Le noeud files sert pour les modifications sur le système de fichier -->
    <files>
      <!-- la balise directory permet de créer des répertoires -->
      <directory>machin</directory>
      <directory>modules/ammmii</directory>

      <!-- La balise copy peut permettre d'extraire un fichier de l'archive. Ici on extrait le fichier index.php -->
      <copy from="index.php" to="modules/ammmii/index.php" />
      <!-- On peut aussi utiliser la balise copy pour remplir un fichier vierge. On va créer le fichier bidon.php dans machin-->
      <copy to="machin/bidon.php"><![CDATA[<?php
/* Il faut toujours un fichier bidon dans le machin !! */
?>]]></copy>
    </files>

    <!-- patcher contient les modifications à effectuer sur les fichiers existants -->
    <patcher>

      <!-- on travail sur le fichier modules/Admin/modules.php -->
      <file name="modules/Admin/modules.php">

        <!-- Aller, on fait un patch sur le fichier ! -->
        <patch>
          <!-- find permet de trouver où le patch doit être appliqué. A noté que ça peut être sur plusieurs lignes (comme ici) -->
          <find><![CDATA[function main()
    {
        global]]></find>

          <!-- nline ajoute le contenu de sa balise sur une nouvelle ligne après la dernière ligne du "find" -->
          <nline><![CDATA[echo "<p><a href=\"?a=ins&file=PackageMgr&page=admin\">Installer un module via PackageMgr</a></p>";
]]></nline>

          <!-- On peut faire plusieur modification pour le même "patch". Ici j'ai choisi de rajouté la variable globale bibi qui ne sert strictement à rien. On recherche le "match" et on le remplace par le contenu -->
          <replace match="global"><![CDATA[global $bibi,]]></replace>
        </patch>

        <!-- Aller on se fait un deuxième patch pour le délir ! -->
        <patch>
          <find><![CDATA[<?php]]></find>

          <!-- Quand il n'y a pas de match, le replace remplace la totalité du find par son contenu -->
          <replace><![CDATA[<?php /* Et oui ça ne sert à rien ! */]]></replace>
        </patch>
      </file>
    </patcher>

    <!-- Facultatif, actions à réaliser après l'activation -->
    <oninstall>
      <!-- On peut faire une requête SQL ! {PREFIX} est remplacé par le prefixe de la base de donnée -->
      <sql><![CDATA[UPDATE {PREFIX}_config SET value = "Youhou !" WHERE name = "name"]]></sql>

      <!-- On peut executer un script PHP -->
      <eval><![CDATA[echo "Tout s'est finalement déroulé comme prévu, j'ai même pourri le titre de ton site !";]]></eval>

      <!-- Enfin executer un fichier PHP -->
      <exec>machin/bidule.php</exec>
    </oninstall>

    <!-- Il y a aussi un noeud onremove pour quand on désactive le patch qui fonctionne exactement comme oninstall -->
  </body>
</package>
